<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>F# compiler</title>
    <meta name="description" content="Excursion into the F# compiler">
    <meta name="author" content="Steffen Forkmann">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="//code.jquery.com/jquery-1.8.0.js"></script>
    <script src="//code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/night.css" id="theme">
    <link type="text/css" rel="stylesheet" href="fsharp.formatting/styles/style.css" />
    <link type="text/css" rel="stylesheet" href="fsharp.formatting/styles/deedle.css" />
    <link type="text/css" rel="stylesheet" href="css/custom.css" />
    <script src="fsharp.formatting/styles/tips.js" type="text/javascript"></script>
    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">
    <link rel="stylesheet" href="css/fsreveal.css">
    <!-- If the query includes 'print-pdf', include the PDF print sheet -->
    <script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
    </script>
    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
    <script language="javascript" type="text/javascript">
        function init()
        {
            websocket = new WebSocket("ws://"+window.location.host+"/websocket");
            websocket.onmessage = function(evt) { location.reload(); };
        }
        window.addEventListener("load", init, false);
    </script>
</head>
<body>
    <div class="reveal">
        <div class="tip" id="fs1">val offwhite : char list<br /><br />Full name: index.offwhite</div>
<div class="tip" id="fs2">val not : value:bool -&gt; bool<br /><br />Full name: Microsoft.FSharp.Core.Operators.not</div>
<div class="tip" id="fs3">Multiple items<br />val int64 : value:&#39;T -&gt; int64 (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int64<br /><br />--------------------<br />type int64 = System.Int64<br /><br />Full name: Microsoft.FSharp.Core.int64<br /><br />--------------------<br />type int64&lt;&#39;Measure&gt; = int64<br /><br />Full name: Microsoft.FSharp.Core.int64&lt;_&gt;</div>
<div class="tip" id="fs4">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs5">namespace System</div>
<div class="tip" id="fs6">Multiple items<br />type Object =<br />&#160;&#160;new : unit -&gt; obj<br />&#160;&#160;member Equals : obj:obj -&gt; bool<br />&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;member GetType : unit -&gt; Type<br />&#160;&#160;member ToString : unit -&gt; string<br />&#160;&#160;static member Equals : objA:obj * objB:obj -&gt; bool<br />&#160;&#160;static member ReferenceEquals : objA:obj * objB:obj -&gt; bool<br /><br />Full name: System.Object<br /><br />--------------------<br />System.Object() : unit</div>
<div class="tip" id="fs7">System.Object.ReferenceEquals(objA: obj, objB: obj) : bool</div>
<div class="tip" id="fs8">val raise : exn:System.Exception -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.raise</div>
<div class="tip" id="fs9">Multiple items<br />type ArgumentNullException =<br />&#160;&#160;inherit ArgumentException<br />&#160;&#160;new : unit -&gt; ArgumentNullException + 3 overloads<br /><br />Full name: System.ArgumentNullException<br /><br />--------------------<br />System.ArgumentNullException() : unit<br />System.ArgumentNullException(paramName: string) : unit<br />System.ArgumentNullException(message: string, innerException: exn) : unit<br />System.ArgumentNullException(paramName: string, message: string) : unit</div>
<div class="tip" id="fs10">val sign : value:&#39;T -&gt; int (requires member get_Sign)<br /><br />Full name: Microsoft.FSharp.Core.Operators.sign</div>
<div class="tip" id="fs11">namespace System.Collections</div>
<div class="tip" id="fs12">namespace System.Collections.Generic</div>
<div class="tip" id="fs13">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs14">Multiple items<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member GetSlice : startIndex:int option * endIndex:int option -&gt; &#39;T list<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs15">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs16">Multiple items<br />type NoEqualityAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; NoEqualityAttribute<br /><br />Full name: Microsoft.FSharp.Core.NoEqualityAttribute<br /><br />--------------------<br />new : unit -&gt; NoEqualityAttribute</div>
<div class="tip" id="fs17">Multiple items<br />type NoComparisonAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; NoComparisonAttribute<br /><br />Full name: Microsoft.FSharp.Core.NoComparisonAttribute<br /><br />--------------------<br />new : unit -&gt; NoComparisonAttribute</div>
<div class="tip" id="fs18">val id : x:&#39;T -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.id</div>
<div class="tip" id="fs19">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs20">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs21">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs22">val filter : predicate:(&#39;T -&gt; bool) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.filter</div>
<div class="tip" id="fs23">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;U list<br /><br />Full name: Microsoft.FSharp.Collections.List.map</div>
<div class="tip" id="fs24">val exists : predicate:(&#39;T -&gt; bool) -&gt; list:&#39;T list -&gt; bool<br /><br />Full name: Microsoft.FSharp.Collections.List.exists</div>
<div class="tip" id="fs25">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.map</div>
<div class="tip" id="fs26">Multiple items<br />module Set<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type Set&lt;&#39;T (requires comparison)&gt; =<br />&#160;&#160;interface IComparable<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;interface ICollection&lt;&#39;T&gt;<br />&#160;&#160;new : elements:seq&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt;<br />&#160;&#160;member Add : value:&#39;T -&gt; Set&lt;&#39;T&gt;<br />&#160;&#160;member Contains : value:&#39;T -&gt; bool<br />&#160;&#160;override Equals : obj -&gt; bool<br />&#160;&#160;member IsProperSubsetOf : otherSet:Set&lt;&#39;T&gt; -&gt; bool<br />&#160;&#160;member IsProperSupersetOf : otherSet:Set&lt;&#39;T&gt; -&gt; bool<br />&#160;&#160;...<br /><br />Full name: Microsoft.FSharp.Collections.Set&lt;_&gt;<br /><br />--------------------<br />new : elements:seq&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt;</div>
<div class="tip" id="fs27">val ofSeq : elements:seq&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Set.ofSeq</div>
<div class="tip" id="fs28">val filter : predicate:(&#39;T -&gt; bool) -&gt; list:&#39;T list -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.filter</div>
<div class="tip" id="fs29">val ofList : elements:&#39;T list -&gt; Set&lt;&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Set.ofList</div>
<div class="tip" id="fs30">val difference : set1:Set&lt;&#39;T&gt; -&gt; set2:Set&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Set.difference</div>
<div class="tip" id="fs31">val toList : source:seq&lt;&#39;T&gt; -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.Seq.toList</div>
<div class="tip" id="fs32">val distinct : list:&#39;T list -&gt; &#39;T list (requires equality)<br /><br />Full name: Microsoft.FSharp.Collections.List.distinct</div>
<div class="tip" id="fs33">val sortBy : projection:(&#39;T -&gt; &#39;Key) -&gt; list:&#39;T list -&gt; &#39;T list (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.List.sortBy</div>
<div class="tip" id="fs34">type &#39;T option = Option&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.option&lt;_&gt;</div>
<div class="tip" id="fs35">type bool = System.Boolean<br /><br />Full name: Microsoft.FSharp.Core.bool</div>
<div class="tip" id="fs36">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">
            <section >
<section >
<h3>A journey into the F# compiler</h3>
<p>Steffen Forkmann</p>
</section>
<section >
<h3>Disclaimer</h3>
<p>This is NOT a formal compiler design talk</p>
</section>
<section >
<h3>Disclaimer</h3>
<p><img src="images/PRs.png" alt="PRs" /></p>
<p>My current level: Knowing just enough to be dangerous</p>
</section>
</section>
<section >
<section >
<h3>What is a compiler?</h3>
</section>
<section >
<p>Source code</p>
<p>-&gt; Compiler</p>
<p>-&gt; Program / Error message</p>
</section>
</section>
<section >
<section >
<h3>Lexer</h3>
<br /><br />
Source code -> Lexer  ==> Stream of Tokens
</section>
<section >
<p><img src="images/Lexer.png" alt="Lexer pattern match" /></p>
</section>
<section >
<h3>Tabs vs. Spaces</h3>
<img src="images/tabs.png" alt="Tabs vs. Spaces" >
</section>
<section >
<h3>Tabs vs. Spaces - lex.fsl</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">offwhite</span> <span class="o">=</span> [<span class="s">&#39;\t&#39;</span>]

<span class="k">match</span> <span class="i">token</span> <span class="k">with</span>
<span class="o">..</span><span class="o">.</span>
| <span onmouseout="hideTip(event, 'fs1', 2)" onmouseover="showTip(event, 'fs1', 2)" class="i">offwhite</span><span class="o">+</span>  
    { <span class="k">if</span> <span class="i">args</span><span class="o">.</span><span class="i">lightSyntaxStatus</span><span class="o">.</span><span class="i">Status</span> <span class="k">then</span> 
          <span class="i">errorR</span>(<span class="i">Error</span>(<span class="i">FSComp</span><span class="o">.</span><span class="i">SR</span><span class="o">.</span><span class="i">lexTabsNotAllowed</span>(),<span class="i">lexbuf</span><span class="o">.</span><span class="i">LexemeRange</span>))
      
      <span class="k">if</span> <span onmouseout="hideTip(event, 'fs2', 3)" onmouseover="showTip(event, 'fs2', 3)" class="i">not</span> <span class="i">skip</span> <span class="k">then</span> 
          <span class="i">WHITESPACE</span> (<span class="i">LexCont</span><span class="o">.</span><span class="i">Token</span> <span class="o">!</span><span class="i">args</span><span class="o">.</span><span class="i">ifdefStack</span>)
      <span class="k">else</span> 
          <span class="i">token</span> <span class="i">args</span> <span class="i">skip</span> <span class="i">lexbuf</span> }
</code></pre></td>
</tr>
</table>
</section>
<section >
<h2>Pull Request #1243 (@AviAvni)</h2>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">creditCardNumber</span> <span class="o">=</span> <span class="n">1234_5678_9012_3456L</span>
<span class="k">let</span> <span class="i">socialSecurityNumber</span> <span class="o">=</span> <span class="n">999_99_9999L</span>
<span class="k">let</span> <span class="i">pi</span> <span class="o">=</span> <span class="n">3.14_15F</span>
<span class="k">let</span> <span class="i">hexBytes</span> <span class="o">=</span> <span class="n">0xFF_EC_DE_5E</span>
<span class="k">let</span> <span class="i">hexWords</span> <span class="o">=</span> <span class="n">0xCAFE_BABE</span>
<span class="k">let</span> <span class="i">maxLong</span> <span class="o">=</span> <span class="n">0x7fff_ffff_ffff_ffffL</span>
<span class="k">let</span> <span class="i">nybbles</span> <span class="o">=</span> <span class="n">0b0010_0101</span>
<span class="k">let</span> <span class="i">bytes</span> <span class="o">=</span> <span class="n">0b11010010_01101001_10010100_10010010</span>
</code></pre></td>
</tr>
</table>
</section>
<section >
<h3>Pull Request #1243</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// before</span>
<span class="k">let</span> <span class="i">integer</span> <span class="o">=</span> <span class="i">digit</span><span class="o">+</span>


<span class="c">// after</span>
<span class="k">let</span> <span class="i">integer</span> <span class="o">=</span> <span class="i">digit</span> ((<span class="i">digit</span> | <span class="i">separator</span>)<span class="o">*</span> <span class="i">digit</span>)<span class="o">?</span>
</code></pre></td>
</tr>
</table>
</section>
<section >
<img src="images/PR1243.png" alt="Underscores in number literals" width=700 >
</section>
</section>
<section >
<section >
<h3>Parser</h3>
<br /><br />
Source code -> Lexer -> Parser ==> Parse tree
</section>
<section >
<h3>Euclidean algorithm (pseudo code)</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">while</span> <span class="i">b</span> <span class="o">&lt;&gt;</span> <span class="n">0</span>
    <span class="k">if</span> <span class="i">a</span> <span class="o">&gt;</span> <span class="i">b</span>
        <span class="i">a</span> <span class="o">:=</span> <span class="i">a</span> <span class="o">-</span> <span class="i">b</span>
    <span class="k">else</span>
        <span class="i">b</span> <span class="o">:=</span> <span class="i">b</span> <span class="o">-</span> <span class="i">a</span>
<span class="k">return</span> <span class="i">a</span>
</code></pre></td>
</tr>
</table>
</section>
<section >
<img src="images/AST.svg.png" alt="AST from wikipedia" width=550 >
</section>
<section >
<h3>Pull Request #1243</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="k">inline</span> ( <span class="o">*.</span> )  (<span class="i">x</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs3', 4)" onmouseover="showTip(event, 'fs3', 4)" class="i">int64</span>)  (<span class="i">y</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs3', 5)" onmouseover="showTip(event, 'fs3', 5)" class="i">int64</span>)  <span class="o">=</span> (# <span class="s">&quot;mul&quot;</span> <span class="i">x</span> <span class="i">y</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs3', 6)" onmouseover="showTip(event, 'fs3', 6)" class="i">int64</span> #)

<span class="c">// convert to int</span>
<span class="k">let</span> <span class="i">ParseInt32</span> (<span class="i">s</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs4', 7)" onmouseover="showTip(event, 'fs4', 7)" class="i">string</span>) <span class="o">=</span> 
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs5', 8)" onmouseover="showTip(event, 'fs5', 8)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs6', 9)" onmouseover="showTip(event, 'fs6', 9)" class="i">Object</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 10)" onmouseover="showTip(event, 'fs7', 10)" class="i">ReferenceEquals</span>(<span class="i">s</span>,<span class="k">null</span>) <span class="k">then</span>
        <span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="i">raise</span>( <span class="k">new</span> <span onmouseout="hideTip(event, 'fs5', 12)" onmouseover="showTip(event, 'fs5', 12)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs9', 13)" onmouseover="showTip(event, 'fs9', 13)" class="i">ArgumentNullException</span>(<span class="s">&quot;s&quot;</span>) )
    <span class="k">let</span> <span class="i">s</span> <span class="o">=</span> <span class="i">removeUnderscores</span> (<span class="i">s</span><span class="o">.</span><span class="i">Trim</span>())
    <span class="k">let</span> <span class="i">l</span> <span class="o">=</span> <span class="i">s</span><span class="o">.</span><span class="i">Length</span> 
    <span class="k">let</span> <span class="k">mutable</span> <span class="i">p</span> <span class="o">=</span> <span class="n">0</span> 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs10', 14)" onmouseover="showTip(event, 'fs10', 14)" class="i">sign</span> <span class="o">=</span> <span class="i">getSign32</span> <span class="i">s</span> <span class="o">&amp;</span> <span class="i">p</span> <span class="i">l</span>
    <span class="k">let</span> <span class="i">specifier</span> <span class="o">=</span> <span class="i">get0OXB</span> <span class="i">s</span> <span class="o">&amp;</span> <span class="i">p</span> <span class="i">l</span> 
    <span class="k">if</span> <span class="i">p</span> <span class="o">&gt;</span><span class="o">=</span> <span class="i">l</span> <span class="k">then</span> <span class="i">formatError</span>() <span class="k">else</span>        
    <span class="k">match</span> <span class="i">Char</span><span class="o">.</span><span class="i">ToLowerInvariant</span>(<span class="i">specifier</span>) <span class="k">with</span>
    | <span class="s">&#39;x&#39;</span> <span class="k">-&gt;</span> 
        <span onmouseout="hideTip(event, 'fs10', 15)" onmouseover="showTip(event, 'fs10', 15)" class="i">sign</span> <span class="o">*.</span> <span class="i">Int64</span><span class="o">.</span><span class="i">Parse</span>(
                    <span class="i">s</span><span class="o">.</span><span class="i">Substring</span>(<span class="i">p</span>), 
                    <span class="i">NumberStyles</span><span class="o">.</span><span class="i">AllowHexSpecifier</span>,
                    <span class="i">CultureInfo</span><span class="o">.</span><span class="i">InvariantCulture</span>)
    | <span class="s">&#39;b&#39;</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs10', 16)" onmouseover="showTip(event, 'fs10', 16)" class="i">sign</span> <span class="o">*.</span> (<span class="i">int64OfUInt64</span> (<span class="i">parseBinaryUInt64</span> <span class="i">s</span> <span class="i">p</span> <span class="i">l</span>))
    | <span class="s">&#39;o&#39;</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs10', 17)" onmouseover="showTip(event, 'fs10', 17)" class="i">sign</span> <span class="o">*.</span> (<span class="i">int64OfUInt64</span> (<span class="i">parseOctalUInt64</span> <span class="i">s</span> <span class="i">p</span> <span class="i">l</span>))
    | _ <span class="k">-&gt;</span> <span class="i">Int64</span><span class="o">.</span><span class="i">Parse</span>(<span class="i">s</span>, <span class="i">NumberStyles</span><span class="o">.</span><span class="i">AllowLeadingSign</span>, <span class="i">CultureInfo</span><span class="o">.</span><span class="i">InvariantCulture</span>)
</code></pre></td>
</tr>
</table>
</section>
</section>
<section >
<section >
<h3>Name resolution</h3>
<br /><br />
Source code -> Lexer -> Parser -> Name resolution ==> AST
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs5', 18)" onmouseover="showTip(event, 'fs5', 18)" class="i">System</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs5', 19)" onmouseover="showTip(event, 'fs5', 19)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 20)" onmouseover="showTip(event, 'fs11', 20)" class="i">Collections</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 21)" onmouseover="showTip(event, 'fs12', 21)" class="i">Generic</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 22)" onmouseover="showTip(event, 'fs13', 22)" class="i">list</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 23)" onmouseover="showTip(event, 'fs14', 23)" class="i">List</span><span class="o">&lt;</span>_<span class="o">&gt;</span>()
<span onmouseout="hideTip(event, 'fs13', 24)" onmouseover="showTip(event, 'fs13', 24)" class="i">list</span><span class="o">.</span><span class="i">Add</span> <span class="n">3</span>

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs14', 25)" onmouseover="showTip(event, 'fs14', 25)" class="i">List</span> <span class="o">=</span> { <span class="o">..</span><span class="o">.</span> }

<span class="k">let</span> <span class="i">f</span> (<span onmouseout="hideTip(event, 'fs13', 26)" onmouseover="showTip(event, 'fs13', 26)" class="i">list</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs14', 27)" onmouseover="showTip(event, 'fs14', 27)" class="i">List</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 28)" onmouseover="showTip(event, 'fs13', 28)" class="i">list</span><span class="o">.</span><span class="i">Length</span>

<span onmouseout="hideTip(event, 'fs15', 29)" onmouseover="showTip(event, 'fs15', 29)" class="i">printfn</span> <span class="s">&quot;%A&quot;</span> <span onmouseout="hideTip(event, 'fs13', 30)" onmouseover="showTip(event, 'fs13', 30)" class="i">list</span><span class="o">.</span><span class="i">Items</span>
</code></pre></td>
</tr>
</table>
</section>
<section >
<h3>Immutable maps FTW</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[&lt;<span onmouseout="hideTip(event, 'fs16', 31)" onmouseover="showTip(event, 'fs16', 31)" class="i">NoEquality</span>; <span onmouseout="hideTip(event, 'fs17', 32)" onmouseover="showTip(event, 'fs17', 32)" class="i">NoComparison</span>&gt;]
<span class="c">/// The environment of information used to resolve names</span>
<span class="k">type</span> <span class="i">NameResolutionEnv</span> <span class="o">=</span>
  { <span class="c">/// Values and Data Tags available by unqualified name </span>
    <span class="i">eUnqualifiedItems</span><span class="o">:</span> <span class="i">LayeredMap</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs4', 33)" onmouseover="showTip(event, 'fs4', 33)" class="i">string</span>,<span class="i">Item</span><span class="o">&gt;</span>
    <span class="c">/// Data Tags and Active Pattern Tags available by unqualified name </span>
    <span class="i">ePatItems</span><span class="o">:</span> <span class="i">NameMap</span><span class="o">&lt;</span><span class="i">Item</span><span class="o">&gt;</span>
    <span class="c">/// Modules accessible via &quot;.&quot; notation. Note this is a multi-map. </span>
    <span class="i">eModulesAndNamespaces</span><span class="o">:</span>  <span class="i">NameMultiMap</span><span class="o">&lt;</span><span class="i">Tast</span><span class="o">.</span><span class="i">ModuleOrNamespaceRef</span><span class="o">&gt;</span>        
    <span class="c">/// Fully qualified modules and namespaces. &#39;open&#39; does not change this. </span>
    <span class="i">eFullyQualifiedModulesAndNamespaces</span><span class="o">:</span>  <span class="i">NameMultiMap</span><span class="o">&lt;</span><span class="i">Tast</span><span class="o">.</span><span class="i">ModuleOrNamespaceRef</span><span class="o">&gt;</span>        
    <span class="c">/// RecdField labels in scope. </span>
    <span class="i">eFieldLabels</span><span class="o">:</span> <span class="i">NameMultiMap</span><span class="o">&lt;</span><span class="i">Tast</span><span class="o">.</span><span class="i">RecdFieldRef</span><span class="o">&gt;</span>

    <span class="c">/// ...</span>

    <span class="c">/// Extension members by type and name </span>
    <span class="i">eIndexedExtensionMembers</span><span class="o">:</span> <span class="i">TyconRefMultiMap</span><span class="o">&lt;</span><span class="i">ExtensionMember</span><span class="o">&gt;</span>
    } 
</code></pre></td>
</tr>
</table>
</section>
<section >
<p><img src="images/ErrorReporting.png" alt="PRs" /></p>
</section>
<section >
<h3>Pull Request #1102</h3>
<p><img src="images/recordlabel.png" alt="Record labels" /></p>
</section>
<section >
<h3>Pull Request #1102</h3>
<p><img src="images/recordlabel2.png" alt="Record labels" /></p>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Resolve a long identifier representing a record field </span>
<span class="k">let</span> <span class="i">ResolveFieldPrim</span> (<span class="i">ncenv</span><span class="o">:</span><span class="i">NameResolver</span>) <span class="i">nenv</span> <span class="i">ad</span> <span class="i">typ</span> (<span class="i">mp</span>,<span onmouseout="hideTip(event, 'fs18', 34)" onmouseover="showTip(event, 'fs18', 34)" class="i">id</span><span class="o">:</span><span class="i">Ident</span>) <span class="i">fields</span> <span class="o">=</span>
    <span class="k">let</span> <span class="i">typeNameResInfo</span> <span class="o">=</span> <span class="i">TypeNameResolutionInfo</span><span class="o">.</span><span class="i">Default</span>
    <span class="k">let</span> <span class="i">m</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs18', 35)" onmouseover="showTip(event, 'fs18', 35)" class="i">id</span><span class="o">.</span><span class="i">idRange</span>
    <span class="k">match</span> <span class="i">mp</span> <span class="k">with</span> 
    | [] <span class="k">-&gt;</span> 
        <span class="k">let</span> <span class="i">lookup</span>() <span class="o">=</span> <span class="o">..</span><span class="o">.</span>

        <span class="k">if</span> <span class="i">isAppTy</span> <span class="i">ncenv</span><span class="o">.</span><span class="i">g</span> <span class="i">typ</span> <span class="k">then</span> 
            <span class="k">match</span> <span class="i">ncenv</span><span class="o">.</span><span class="i">InfoReader</span><span class="o">.</span><span class="i">TryFindRecdOrClassFieldInfoOfType</span>(<span onmouseout="hideTip(event, 'fs18', 36)" onmouseover="showTip(event, 'fs18', 36)" class="i">id</span><span class="o">.</span><span class="i">idText</span>,<span class="i">m</span>,<span class="i">typ</span>) <span class="k">with</span>
            | <span onmouseout="hideTip(event, 'fs19', 37)" onmouseover="showTip(event, 'fs19', 37)" class="i">Some</span> (<span class="i">RecdFieldInfo</span>(_,<span class="i">rfref</span>)) <span class="k">-&gt;</span> 
                [<span class="i">ResolutionInfo</span><span class="o">.</span><span class="i">Empty</span>, <span class="i">FieldResolution</span>(<span class="i">rfref</span>,<span class="k">false</span>)]
            | <span onmouseout="hideTip(event, 'fs20', 38)" onmouseover="showTip(event, 'fs20', 38)" class="i">None</span> <span class="k">-&gt;</span>
                <span class="k">let</span> <span class="i">typeName</span> <span class="o">=</span> <span class="i">NicePrint</span><span class="o">.</span><span class="i">minimalStringOfType</span> <span class="i">nenv</span><span class="o">.</span><span class="i">eDisplayEnv</span> <span class="i">typ</span>
                <span class="k">if</span> <span class="i">isRecdTy</span> <span class="i">ncenv</span><span class="o">.</span><span class="i">g</span> <span class="i">typ</span> <span class="k">then</span>               
                    <span class="i">error</span>(<span class="i">SuggestOtherLabelsOfSameRecordType</span> <span class="i">nenv</span> <span class="i">typeName</span> <span onmouseout="hideTip(event, 'fs18', 39)" onmouseover="showTip(event, 'fs18', 39)" class="i">id</span> <span class="i">fields</span>,<span class="i">m</span>)
                <span class="k">else</span>
                    <span class="i">lookup</span>()
        <span class="k">else</span> 
            <span class="i">lookup</span>()
    | _ <span class="k">-&gt;</span> <span class="o">..</span><span class="o">.</span>
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Suggest other labels of the same record</span>
<span class="k">let</span> <span class="i">SuggestOtherLabelsOfSameRecordType</span> (<span class="i">nenv</span><span class="o">:</span><span class="i">NameResolutionEnv</span>) <span class="i">typeName</span> <span onmouseout="hideTip(event, 'fs18', 40)" onmouseover="showTip(event, 'fs18', 40)" class="i">id</span> <span class="i">fields</span> <span class="o">=</span>    
    <span class="k">let</span> <span class="i">labelsOfPossibleRecord</span> <span class="o">=</span>
        <span class="i">nenv</span><span class="o">.</span><span class="i">eFieldLabels</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs21', 41)" onmouseover="showTip(event, 'fs21', 41)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs22', 42)" onmouseover="showTip(event, 'fs22', 42)" class="i">filter</span> (<span class="k">fun</span> <span class="i">kv</span> <span class="k">-&gt;</span> 
            <span class="i">kv</span><span class="o">.</span><span class="i">Value</span> 
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 43)" onmouseover="showTip(event, 'fs14', 43)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 44)" onmouseover="showTip(event, 'fs23', 44)" class="i">map</span> (<span class="k">fun</span> <span class="i">r</span> <span class="k">-&gt;</span> <span class="i">r</span><span class="o">.</span><span class="i">TyconRef</span><span class="o">.</span><span class="i">DisplayName</span>)
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 45)" onmouseover="showTip(event, 'fs14', 45)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs24', 46)" onmouseover="showTip(event, 'fs24', 46)" class="i">exists</span> ((<span class="o">=</span>) <span class="i">typeName</span>))
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs21', 47)" onmouseover="showTip(event, 'fs21', 47)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs25', 48)" onmouseover="showTip(event, 'fs25', 48)" class="i">map</span> (<span class="k">fun</span> <span class="i">kv</span> <span class="k">-&gt;</span> <span class="i">kv</span><span class="o">.</span><span class="i">Key</span>)
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs26', 49)" onmouseover="showTip(event, 'fs26', 49)" class="i">Set</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 50)" onmouseover="showTip(event, 'fs27', 50)" class="i">ofSeq</span>

    <span class="k">let</span> <span class="i">givenFields</span> <span class="o">=</span> 
        <span class="i">fields</span> 
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 51)" onmouseover="showTip(event, 'fs14', 51)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 52)" onmouseover="showTip(event, 'fs23', 52)" class="i">map</span> (<span class="k">fun</span> <span class="i">fld</span> <span class="k">-&gt;</span> <span class="i">fld</span><span class="o">.</span><span class="i">idText</span>) 
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 53)" onmouseover="showTip(event, 'fs14', 53)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 54)" onmouseover="showTip(event, 'fs28', 54)" class="i">filter</span> ((<span class="o">&lt;&gt;</span>) <span onmouseout="hideTip(event, 'fs18', 55)" onmouseover="showTip(event, 'fs18', 55)" class="i">id</span><span class="o">.</span><span class="i">idText</span>)
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs26', 56)" onmouseover="showTip(event, 'fs26', 56)" class="i">Set</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 57)" onmouseover="showTip(event, 'fs29', 57)" class="i">ofList</span>

    <span class="k">let</span> <span class="i">predictedLabels</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs26', 58)" onmouseover="showTip(event, 'fs26', 58)" class="i">Set</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs30', 59)" onmouseover="showTip(event, 'fs30', 59)" class="i">difference</span> <span class="i">labelsOfPossibleRecord</span> <span class="i">givenFields</span>
    <span class="k">let</span> <span class="i">predictions</span> <span class="o">=</span> <span class="i">ErrorResolutionHints</span><span class="o">.</span><span class="i">FilterPredictions</span> <span onmouseout="hideTip(event, 'fs18', 60)" onmouseover="showTip(event, 'fs18', 60)" class="i">id</span><span class="o">.</span><span class="i">idText</span> <span class="i">predictedLabels</span>

    <span class="k">let</span> <span class="i">errorCode</span>,<span class="i">text</span> <span class="o">=</span> <span class="i">FSComp</span><span class="o">.</span><span class="i">SR</span><span class="o">.</span><span class="i">nrRecordDoesNotContainSuchLabel</span>(<span class="i">typeName</span>, <span onmouseout="hideTip(event, 'fs18', 61)" onmouseover="showTip(event, 'fs18', 61)" class="i">id</span><span class="o">.</span><span class="i">idText</span>)
    <span class="i">errorCode</span>,<span class="i">text</span> <span class="o">+</span> <span class="i">ErrorResolutionHints</span><span class="o">.</span><span class="i">FormatPredictions</span> <span class="i">predictions</span>
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Filters predictions based on edit distance to an unknown identifier.</span>
<span class="k">let</span> <span class="i">FilterPredictions</span> <span class="i">unknownIdent</span> <span class="i">allPredictions</span> <span class="o">=</span>
    <span class="i">allPredictions</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs21', 62)" onmouseover="showTip(event, 'fs21', 62)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 63)" onmouseover="showTip(event, 'fs31', 63)" class="i">toList</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 64)" onmouseover="showTip(event, 'fs14', 64)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs32', 65)" onmouseover="showTip(event, 'fs32', 65)" class="i">distinct</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs14', 66)" onmouseover="showTip(event, 'fs14', 66)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs33', 67)" onmouseover="showTip(event, 'fs33', 67)" class="i">sortBy</span> (<span class="k">fun</span> <span class="i">s</span> <span class="k">-&gt;</span> <span class="i">EditDistance</span><span class="o">.</span><span class="i">CalcEditDistance</span>(<span class="i">unknownIdent</span>,<span class="i">s</span>))
    <span class="o">|&gt;</span> <span class="i">take</span> <span class="n">5</span>
</code></pre></td>
</tr>
</table>
</section>
</section>
<section >
<section >
<h3>Type checking</h3>
<h4>Hindley-Milner Type Inference Algorithm</h4>
<br /><br />
Source code -> Lexer -> Parser -> Name resolution <br />
-> Type checker ==> TAST
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">TcEnv</span> <span class="o">=</span>
  { <span class="i">eNameResEnv</span> <span class="o">:</span> <span class="i">NameResolutionEnv</span> 
    <span class="i">eUngeneralizableItems</span><span class="o">:</span> <span class="i">UngeneralizableItem</span> <span onmouseout="hideTip(event, 'fs13', 68)" onmouseover="showTip(event, 'fs13', 68)" class="i">list</span>
    <span class="i">eCompPath</span><span class="o">:</span> <span class="i">CompilationPath</span> 
    <span class="i">eAccessPath</span><span class="o">:</span> <span class="i">CompilationPath</span>         
    <span class="i">eContextInfo</span> <span class="o">:</span> <span class="i">ContextInfo</span> 
    <span class="i">eCallerMemberName</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs4', 69)" onmouseover="showTip(event, 'fs4', 69)" class="i">string</span> <span onmouseout="hideTip(event, 'fs34', 70)" onmouseover="showTip(event, 'fs34', 70)" class="i">option</span>
    <span class="c">// ...</span>
    }

<span class="k">type</span> <span class="i">cenv</span> <span class="o">=</span> 
  { <span class="i">g</span><span class="o">:</span> <span class="i">TcGlobals</span>
    <span class="i">tcSink</span><span class="o">:</span> <span class="i">TcResultsSink</span> 
    <span class="i">topCcu</span><span class="o">:</span> <span class="i">CcuThunk</span>  
    <span class="i">css</span><span class="o">:</span> <span class="i">ConstraintSolverState</span>
    <span class="c">// ...        </span>
    } 
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="k">rec</span> <span class="i">fib</span> <span class="i">n</span> <span class="o">=</span> 
    <span class="k">if</span> <span class="i">n</span> <span class="o">&lt;=</span> <span class="n">2</span> <span class="k">then</span> 
        <span class="n">1</span>
    <span class="k">else</span> 
        <span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">1</span>) <span class="o">+</span> <span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">2</span>)
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// if :: bool - &#39;a - &#39;a -&gt; &#39;a</span>
<span class="k">if</span> <span class="i">n</span> <span class="o">&lt;=</span> <span class="n">2</span> <span class="k">then</span> 
    <span class="n">1</span>
<span class="k">else</span> 
    <span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">1</span>) <span class="o">+</span> <span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">2</span>)
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// if :: bool - &#39;a - &#39;a -&gt; &#39;a</span>
<span class="k">if</span> <span class="i">n</span> <span class="o">&lt;=</span> <span class="n">2</span> <span class="k">then</span> 
    <span class="n">1</span>
<span class="k">else</span> 
    <span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">1</span>) <span class="o">+</span> <span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">2</span>) 

[<span class="i">T_COND</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs35', 71)" onmouseover="showTip(event, 'fs35', 71)" class="i">bool</span>]
[<span class="i">T_IF</span><span class="o">:</span> <span class="o">&#39;</span><span class="i">a</span>]
[<span class="i">T_ELSE</span><span class="o">:</span> <span class="o">&#39;</span><span class="i">a</span>]
[<span class="i">T_IF</span> <span class="o">=</span> <span class="i">T_ELSE</span>]
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// if :: bool - &#39;a - &#39;a -&gt; &#39;a</span>
<span class="k">if</span> <span class="i">n</span> <span class="o">&lt;=</span> <span class="n">2</span> <span class="k">then</span> 
    <span class="n">1</span>
<span class="k">else</span> 
    <span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">1</span>) <span class="o">+</span> <span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">2</span>) 

[<span class="i">T_COND</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs35', 72)" onmouseover="showTip(event, 'fs35', 72)" class="i">bool</span>]
[<span class="i">T_IF</span><span class="o">:</span> <span class="o">&#39;</span><span class="i">a</span>]
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// (&lt;=) :: &#39;a -&gt; &#39;a -&gt; bool when &#39;a is Number</span>
<span class="i">n</span> <span class="o">&lt;=</span> <span class="n">2</span>

[<span class="i">T_n</span><span class="o">:</span> <span class="o">&#39;</span><span class="i">a</span> <span class="k">when</span> <span class="o">&#39;</span><span class="i">a</span> <span class="i">is</span> <span class="i">Number</span>]
[<span class="i">T_2</span><span class="o">:</span> <span class="o">&#39;</span><span class="i">a</span> <span class="k">when</span> <span class="o">&#39;</span><span class="i">a</span> <span class="i">is</span> <span class="i">Number</span>]
[<span class="i">T_n</span> <span class="o">=</span> <span class="i">T_2</span>]
[<span class="i">T_COND</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs35', 73)" onmouseover="showTip(event, 'fs35', 73)" class="i">bool</span>]
[<span class="i">T_IF</span><span class="o">:</span> <span class="o">&#39;</span><span class="i">a</span>]
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// 2 :: int</span>
<span class="i">n</span> <span class="o">&lt;=</span> <span class="n">2</span>

[<span class="i">T_n</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 74)" onmouseover="showTip(event, 'fs36', 74)" class="i">int</span>]
[<span class="i">T_2</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 75)" onmouseover="showTip(event, 'fs36', 75)" class="i">int</span>]
[<span class="i">T_COND</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs35', 76)" onmouseover="showTip(event, 'fs35', 76)" class="i">bool</span>]
[<span class="i">T_IF</span><span class="o">:</span> <span class="o">&#39;</span><span class="i">a</span>]
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">if</span> <span class="i">n</span> <span class="o">&lt;=</span> <span class="n">2</span> <span class="k">then</span> 
    <span class="n">1</span> <span class="c">// 1 :: int</span>
<span class="k">else</span> 
    <span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">1</span>) <span class="o">+</span> <span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">2</span>) 

[<span class="i">T_n</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 77)" onmouseover="showTip(event, 'fs36', 77)" class="i">int</span>]
[<span class="i">T_2</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 78)" onmouseover="showTip(event, 'fs36', 78)" class="i">int</span>]
[<span class="i">T_COND</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs35', 79)" onmouseover="showTip(event, 'fs35', 79)" class="i">bool</span>]
[<span class="i">T_IF</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 80)" onmouseover="showTip(event, 'fs36', 80)" class="i">int</span>]
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// (+) :: &#39;a -&gt; &#39;a -&gt; &#39;a when &#39;a is Number    </span>
(<span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">1</span>)) <span class="o">+</span> (<span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">2</span>))

[<span class="i">T_n</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 81)" onmouseover="showTip(event, 'fs36', 81)" class="i">int</span>]
[<span class="i">T_2</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 82)" onmouseover="showTip(event, 'fs36', 82)" class="i">int</span>]
[<span class="i">T_COND</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs35', 83)" onmouseover="showTip(event, 'fs35', 83)" class="i">bool</span>]
[<span class="i">T_IF</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 84)" onmouseover="showTip(event, 'fs36', 84)" class="i">int</span>]
[<span class="i">T_Left</span><span class="o">:</span> <span class="o">&#39;</span><span class="i">a</span> <span class="k">when</span> <span class="o">&#39;</span><span class="i">a</span> <span class="i">is</span> <span class="i">Number</span>]
[<span class="i">T_Right</span><span class="o">:</span> <span class="o">&#39;</span><span class="i">a</span> <span class="k">when</span> <span class="o">&#39;</span><span class="i">a</span> <span class="i">is</span> <span class="i">Number</span>]
[<span class="i">T_Left</span> <span class="o">=</span> <span class="i">T_Right</span>]
[<span class="i">T_Left</span> <span class="o">=</span> <span class="i">T_IF</span>]
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// (+) :: &#39;a -&gt; &#39;a -&gt; &#39;a when &#39;a is Number    </span>
(<span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">1</span>)) <span class="o">+</span> (<span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">2</span>))

[<span class="i">T_n</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 85)" onmouseover="showTip(event, 'fs36', 85)" class="i">int</span>]
[<span class="i">T_2</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 86)" onmouseover="showTip(event, 'fs36', 86)" class="i">int</span>]
[<span class="i">T_COND</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs35', 87)" onmouseover="showTip(event, 'fs35', 87)" class="i">bool</span>]
[<span class="i">T_IF</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 88)" onmouseover="showTip(event, 'fs36', 88)" class="i">int</span>]
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// fib :: &#39;a -&gt; &#39;b</span>
<span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">1</span>)

[<span class="i">T_n</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 89)" onmouseover="showTip(event, 'fs36', 89)" class="i">int</span>]
[<span class="i">T_2</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 90)" onmouseover="showTip(event, 'fs36', 90)" class="i">int</span>]
[<span class="i">T_COND</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs35', 91)" onmouseover="showTip(event, 'fs35', 91)" class="i">bool</span>]
[<span class="i">T_IF</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 92)" onmouseover="showTip(event, 'fs36', 92)" class="i">int</span>]
[<span class="i">T_Fib</span><span class="o">:</span> <span class="o">&#39;</span><span class="i">a</span> <span class="k">-&gt;</span> <span class="o">&#39;</span><span class="i">b</span>]
[<span class="i">T_Arg</span><span class="o">:</span> <span class="o">&#39;</span><span class="i">a</span>]
[<span class="i">T_FibResult</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 93)" onmouseover="showTip(event, 'fs36', 93)" class="i">int</span>]
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// (-) :: &#39;a -&gt; &#39;a -&gt; &#39;a when &#39;a is number</span>
(<span class="i">n</span> <span class="o">-</span> <span class="n">1</span>)

[<span class="i">T_n</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 94)" onmouseover="showTip(event, 'fs36', 94)" class="i">int</span>]
[<span class="i">T_2</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 95)" onmouseover="showTip(event, 'fs36', 95)" class="i">int</span>]
[<span class="i">T_COND</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs35', 96)" onmouseover="showTip(event, 'fs35', 96)" class="i">bool</span>]
[<span class="i">T_IF</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 97)" onmouseover="showTip(event, 'fs36', 97)" class="i">int</span>]
[<span class="i">T_Fib</span><span class="o">:</span> <span class="o">&#39;</span><span class="i">a</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs36', 98)" onmouseover="showTip(event, 'fs36', 98)" class="i">int</span>]
[<span class="i">T_Arg</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 99)" onmouseover="showTip(event, 'fs36', 99)" class="i">int</span>]
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="k">rec</span> <span class="i">fib</span> <span class="i">n</span> <span class="o">=</span> 
    <span class="k">if</span> <span class="i">n</span> <span class="o">&lt;=</span> <span class="n">2</span> <span class="k">then</span> 
        <span class="n">1</span>
    <span class="k">else</span> 
        <span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">1</span>) <span class="o">+</span> <span class="i">fib</span> (<span class="i">n</span> <span class="o">-</span> <span class="n">2</span>)

[<span class="i">T_n</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 100)" onmouseover="showTip(event, 'fs36', 100)" class="i">int</span>]
[<span class="i">T_2</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 101)" onmouseover="showTip(event, 'fs36', 101)" class="i">int</span>]
[<span class="i">T_COND</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs35', 102)" onmouseover="showTip(event, 'fs35', 102)" class="i">bool</span>]
[<span class="i">T_IF</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 103)" onmouseover="showTip(event, 'fs36', 103)" class="i">int</span>]
[<span class="i">T_Fib</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs36', 104)" onmouseover="showTip(event, 'fs36', 104)" class="i">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs36', 105)" onmouseover="showTip(event, 'fs36', 105)" class="i">int</span>]
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">UnifyTypes</span> <span class="i">cenv</span> (<span class="i">env</span><span class="o">:</span> <span class="i">TcEnv</span>) <span class="i">m</span> <span class="i">expectedTy</span> <span class="i">actualTy</span> <span class="o">=</span> 
    <span class="i">ConstraintSolver</span><span class="o">.</span><span class="i">AddCxTypeEqualsType</span> <span class="i">env</span><span class="o">.</span><span class="i">eContextInfo</span> <span class="i">env</span><span class="o">.</span><span class="i">DisplayEnv</span> <span class="i">cenv</span><span class="o">.</span><span class="i">css</span> <span class="i">m</span> 
       (<span class="i">tryNormalizeMeasureInType</span> <span class="i">cenv</span><span class="o">.</span><span class="i">g</span> <span class="i">expectedTy</span>) 
       (<span class="i">tryNormalizeMeasureInType</span> <span class="i">cenv</span><span class="o">.</span><span class="i">g</span> <span class="i">actualTy</span>)
</code></pre></td>
</tr>
</table>
</section>
<section >
<h3>Pull Request #1149</h3>
<p><img src="images/downcast.png" alt="type test" /></p>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">SolveTypSubsumesTypWithReport</span> (<span class="i">csenv</span><span class="o">:</span><span class="i">ConstraintSolverEnv</span>) <span class="i">ndeep</span> <span class="i">m</span> <span class="i">trace</span> <span class="i">ty1</span> <span class="i">ty2</span> <span class="o">=</span>
    <span class="i">TryD</span> (<span class="k">fun</span> () <span class="k">-&gt;</span> <span class="i">SolveTypSubsumesTypKeepAbbrevs</span> <span class="i">csenv</span> <span class="i">ndeep</span> <span class="i">m</span> <span class="i">trace</span> <span class="i">ty1</span> <span class="i">ty2</span>)
        (<span class="k">fun</span> <span class="i">res</span> <span class="k">-&gt;</span>
            <span class="k">match</span> <span class="i">csenv</span><span class="o">.</span><span class="i">eContextInfo</span> <span class="k">with</span>
            | <span class="i">ContextInfo</span><span class="o">.</span><span class="i">RuntimeTypeTest</span> <span class="k">-&gt;</span>
                <span class="c">// test if we can cast other way around</span>
                <span class="k">match</span> <span class="i">CollectThenUndo</span> (<span class="k">fun</span> _ <span class="k">-&gt;</span> <span class="i">SolveTypSubsumesTypKeepAbbrevs</span> <span class="o">..</span><span class="o">.</span>) <span class="k">with</span> 
                | <span class="i">OkResult</span> _ <span class="k">-&gt;</span> <span class="i">ErrorD</span>(<span class="o">..</span><span class="o">.</span>,<span class="i">ContextInfo</span><span class="o">.</span><span class="i">DowncastUsedInsteadOfUpcast</span>)
                | _ <span class="k">-&gt;</span> <span class="i">ErrorD</span>(<span class="o">..</span><span class="o">.</span>,<span class="i">ContextInfo</span><span class="o">.</span><span class="i">NoContext</span>)
            | _ <span class="k">-&gt;</span> <span class="i">ErrorD</span> (<span class="o">..</span><span class="o">.</span>,<span class="i">csenv</span><span class="o">.</span><span class="i">eContextInfo</span>)
</code></pre></td>
</tr>
</table>
</section>
</section>
<section >
<section >
<h3>Optimizer</h3>
<br /><br />
Source code -> Lexer -> Parser -> Name resolution <br />
-> Type checker -> Optimizer ==> TAST
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="k">rec</span> <span class="i">OptimizeExpr</span> <span class="i">cenv</span> (<span class="i">env</span><span class="o">:</span><span class="i">IncrementalOptimizationEnv</span>) <span class="i">expr</span> <span class="o">=</span>
    <span class="k">match</span> <span class="i">expr</span> <span class="k">with</span>
    | <span class="i">Expr</span><span class="o">.</span><span class="i">Sequential</span> _ | <span class="i">Expr</span><span class="o">.</span><span class="i">Let</span> _ <span class="k">-&gt;</span> <span class="i">OptimizeLinearExpr</span> <span class="i">cenv</span> <span class="i">env</span> <span class="i">expr</span> <span onmouseout="hideTip(event, 'fs18', 106)" onmouseover="showTip(event, 'fs18', 106)" class="i">id</span>
    | <span class="i">Expr</span><span class="o">.</span><span class="i">Const</span> (<span class="i">c</span>,<span class="i">m</span>,<span class="i">ty</span>) <span class="k">-&gt;</span> <span class="i">OptimizeConst</span> <span class="i">cenv</span> <span class="i">env</span> <span class="i">expr</span> (<span class="i">c</span>,<span class="i">m</span>,<span class="i">ty</span>)
    | <span class="i">Expr</span><span class="o">.</span><span class="i">Val</span> (<span class="i">v</span>,<span class="i">_vFlags</span>,<span class="i">m</span>) <span class="k">-&gt;</span> <span class="i">OptimizeVal</span> <span class="i">cenv</span> <span class="i">env</span> <span class="i">expr</span> (<span class="i">v</span>,<span class="i">m</span>)
    | <span class="i">Expr</span><span class="o">.</span><span class="i">Quote</span>(<span class="i">ast</span>,<span class="i">splices</span>,<span class="i">isFromQueryExpression</span>,<span class="i">m</span>,<span class="i">ty</span>) <span class="k">-&gt;</span> <span class="o">..</span><span class="o">.</span>
    | <span class="i">Expr</span><span class="o">.</span><span class="i">App</span>(<span class="i">f</span>,<span class="i">fty</span>,<span class="i">tyargs</span>,<span class="i">argsl</span>,<span class="i">m</span>) <span class="k">-&gt;</span> 
        <span class="c">// eliminate uses of query</span>
        <span class="k">match</span> <span class="i">TryDetectQueryQuoteAndRun</span> <span class="i">cenv</span> <span class="i">expr</span> <span class="k">with</span> 
        | <span onmouseout="hideTip(event, 'fs19', 107)" onmouseover="showTip(event, 'fs19', 107)" class="i">Some</span> <span class="i">newExpr</span> <span class="k">-&gt;</span> <span class="i">OptimizeExpr</span> <span class="i">cenv</span> <span class="i">env</span> <span class="i">newExpr</span>
        | <span onmouseout="hideTip(event, 'fs20', 108)" onmouseover="showTip(event, 'fs20', 108)" class="i">None</span> <span class="k">-&gt;</span> <span class="i">OptimizeApplication</span> <span class="i">cenv</span> <span class="i">env</span> (<span class="i">f</span>,<span class="i">fty</span>,<span class="i">tyargs</span>,<span class="i">argsl</span>,<span class="i">m</span>)
    <span class="o">..</span><span class="o">.</span>
</code></pre></td>
</tr>
</table>
</section>
<section >
<h3>Optimizer</h3>
<ul>
<li>Inlining</li>
<li>Inner lambda to top level funcs</li>
<li>Removing tuples</li>
<li>Optimize seq { } workflows</li>
<li>Numeric calculations</li>
<li>Beta reduction</li>
<li>...</li>
</ul>
</section>
<section >
<h3>Optimizer</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">y</span> <span class="o">=</span> (<span class="k">fun</span> <span class="i">x</span> <span class="k">-&gt;</span> <span class="n">2</span> <span class="o">+</span> <span class="i">x</span> <span class="o">*</span> <span class="i">x</span>) <span class="n">3</span>

<span class="c">// beta reduction</span>
<span class="k">let</span> <span class="i">y</span> <span class="o">=</span> <span class="n">2</span> <span class="o">+</span> <span class="n">3</span> <span class="o">*</span> <span class="n">3</span>

<span class="c">// numeric calculations</span>
<span class="c">// (special form of beta reduction)</span>
<span class="k">let</span> <span class="i">y</span> <span class="o">=</span> <span class="n">11</span>
</code></pre></td>
</tr>
</table>
</section>
<section >
<h3>Optimizer experiment: Fusion</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[<span class="s">&quot;hello&quot;</span>; <span class="s">&quot;world&quot;</span>; <span class="s">&quot;!&quot;</span>]
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs21', 109)" onmouseover="showTip(event, 'fs21', 109)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs25', 110)" onmouseover="showTip(event, 'fs25', 110)" class="i">map</span> (<span class="k">fun</span> (<span class="i">y</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs4', 111)" onmouseover="showTip(event, 'fs4', 111)" class="i">string</span>) <span class="k">-&gt;</span> <span class="i">y</span><span class="o">.</span><span class="i">Length</span> <span class="o">*</span> <span class="n">2</span>) 
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs21', 112)" onmouseover="showTip(event, 'fs21', 112)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs25', 113)" onmouseover="showTip(event, 'fs25', 113)" class="i">map</span> (<span class="k">fun</span> <span class="i">x</span> <span class="k">-&gt;</span> <span class="i">x</span> <span class="o">*</span> <span class="n">3</span>)

<span class="c">// after PR 1525 reduction</span>
[<span class="s">&quot;hello&quot;</span>; <span class="s">&quot;world&quot;</span>; <span class="s">&quot;!&quot;</span>]
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs21', 114)" onmouseover="showTip(event, 'fs21', 114)" class="i">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs25', 115)" onmouseover="showTip(event, 'fs25', 115)" class="i">map</span> (<span class="k">fun</span> <span class="i">x</span> <span class="k">-&gt;</span> <span class="i">x</span><span class="o">.</span><span class="i">Length</span> <span class="o">*</span> <span class="n">6</span>)
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">match</span> <span class="i">expr&#39;</span> <span class="k">with</span>
<span class="c">// Rewrite Seq.map f (Seq.map g) xs into Seq.map (fun x -&gt; f(g x)) xs</span>
| <span class="i">Expr</span><span class="o">.</span><span class="i">App</span>(<span class="i">Expr</span><span class="o">.</span><span class="i">Val</span>(<span class="i">outerValRef</span>,_,_) <span class="k">as</span> <span class="i">outerSeqMap</span>,<span class="i">ttype1</span>,[_;<span class="i">fOutType</span>],
            [(<span class="i">Expr</span><span class="o">.</span><span class="i">Lambda</span>(_,<span onmouseout="hideTip(event, 'fs20', 116)" onmouseover="showTip(event, 'fs20', 116)" class="i">None</span>,<span onmouseout="hideTip(event, 'fs20', 117)" onmouseover="showTip(event, 'fs20', 117)" class="i">None</span>,_,_,<span class="i">m1</span>,<span class="i">fRetType</span>) <span class="k">as</span> <span class="i">f</span>)
                <span class="i">Expr</span><span class="o">.</span><span class="i">App</span>(<span class="i">Expr</span><span class="o">.</span><span class="i">Val</span>(<span class="i">innerValRef</span>,_,_),_,[<span class="i">gInType</span>;_],
                        [<span class="i">Expr</span><span class="o">.</span><span class="i">Lambda</span>(_,<span onmouseout="hideTip(event, 'fs20', 118)" onmouseover="showTip(event, 'fs20', 118)" class="i">None</span>,<span onmouseout="hideTip(event, 'fs20', 119)" onmouseover="showTip(event, 'fs20', 119)" class="i">None</span>,<span class="i">gVals</span>,<span class="i">g</span>,_,<span class="i">gRetType</span>)
                            <span class="i">rest</span>],_)],<span class="i">m2</span>) <span class="k">when</span>
    <span class="i">valRefEq</span> <span class="i">cenv</span><span class="o">.</span><span class="i">g</span> <span class="i">innerValRef</span> <span class="i">cenv</span><span class="o">.</span><span class="i">g</span><span class="o">.</span><span class="i">seq_map_vref</span> <span class="o">&amp;&amp;</span>
    <span class="i">valRefEq</span> <span class="i">cenv</span><span class="o">.</span><span class="i">g</span> <span class="i">outerValRef</span> <span class="i">cenv</span><span class="o">.</span><span class="i">g</span><span class="o">.</span><span class="i">seq_map_vref</span> 
        <span class="k">-&gt;</span> 
    <span class="k">let</span> <span class="i">newApp</span> <span class="o">=</span> <span class="i">Expr</span><span class="o">.</span><span class="i">App</span>(<span class="i">f</span>,<span class="i">TType_fun</span>(<span class="i">gRetType</span>, <span class="i">fRetType</span>),[],[<span class="i">g</span>],<span class="i">m2</span>)
    
    <span class="k">let</span> <span class="i">reduced</span> <span class="o">=</span>
        <span class="i">Expr</span><span class="o">.</span><span class="i">App</span>(<span class="i">outerSeqMap</span>,<span class="i">ttype1</span>,[<span class="i">gInType</span>;<span class="i">fOutType</span>],
                [<span class="i">Expr</span><span class="o">.</span><span class="i">Lambda</span>(<span class="i">newUnique</span>(),<span onmouseout="hideTip(event, 'fs20', 120)" onmouseover="showTip(event, 'fs20', 120)" class="i">None</span>,<span onmouseout="hideTip(event, 'fs20', 121)" onmouseover="showTip(event, 'fs20', 121)" class="i">None</span>,<span class="i">gVals</span>,<span class="i">newApp</span>,<span class="i">m1</span>,<span class="i">gRetType</span>) 
                    <span class="i">rest</span>],
                <span class="i">m2</span>)

    <span class="i">OptimizeExpr</span> <span class="i">cenv</span> <span class="i">env</span> <span class="i">reduced</span>
| _ <span class="k">-&gt;</span>
</code></pre></td>
</tr>
</table>
</section>
</section>
<section >
<section >
<h3>Code gen: IL Emitter</h3>
<br /><br />
Source code -> Lexer -> Parser -> Name resolution <br />
-> Type checker -> Optimizer -> IL Emitter ==> Program / PDBs
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="k">rec</span> <span class="i">GenExpr</span> (<span class="i">cenv</span><span class="o">:</span><span class="i">cenv</span>) (<span class="i">cgbuf</span><span class="o">:</span><span class="i">CodeGenBuffer</span>) <span class="i">eenv</span> <span class="i">sp</span> <span class="i">expr</span> <span class="i">sequel</span> <span class="o">=</span>
    <span class="k">match</span> <span class="i">expr</span> <span class="k">with</span> 
    | <span class="i">Expr</span><span class="o">.</span><span class="i">Const</span>(<span class="i">c</span>,<span class="i">m</span>,<span class="i">ty</span>) <span class="k">-&gt;</span> 
        <span class="i">GenConstant</span> <span class="i">cenv</span> <span class="i">cgbuf</span> <span class="i">eenv</span> (<span class="i">c</span>,<span class="i">m</span>,<span class="i">ty</span>) <span class="i">sequel</span>
    | <span class="i">Expr</span><span class="o">.</span><span class="i">Match</span> (<span class="i">spBind</span>,<span class="i">exprm</span>,<span class="i">tree</span>,<span class="i">targets</span>,<span class="i">m</span>,<span class="i">ty</span>) <span class="k">-&gt;</span> 
        <span class="i">GenMatch</span> <span class="i">cenv</span> <span class="i">cgbuf</span> <span class="i">eenv</span> (<span class="i">spBind</span>,<span class="i">exprm</span>,<span class="i">tree</span>,<span class="i">targets</span>,<span class="i">m</span>,<span class="i">ty</span>) <span class="i">sequel</span>
    | <span class="i">Expr</span><span class="o">.</span><span class="i">Sequential</span>(<span class="i">e1</span>,<span class="i">e2</span>,<span class="i">dir</span>,<span class="i">spSeq</span>,<span class="i">m</span>) <span class="k">-&gt;</span>  
        <span class="i">GenSequential</span> <span class="i">cenv</span> <span class="i">cgbuf</span> <span class="i">eenv</span> <span class="i">sp</span> (<span class="i">e1</span>,<span class="i">e2</span>,<span class="i">dir</span>,<span class="i">spSeq</span>,<span class="i">m</span>) <span class="i">sequel</span>
    | <span class="i">Expr</span><span class="o">.</span><span class="i">LetRec</span> (<span class="i">binds</span>,<span class="i">body</span>,<span class="i">m</span>,_)  <span class="k">-&gt;</span> 
        <span class="i">GenLetRec</span> <span class="i">cenv</span> <span class="i">cgbuf</span> <span class="i">eenv</span> (<span class="i">binds</span>,<span class="i">body</span>,<span class="i">m</span>) <span class="i">sequel</span>
    | <span class="i">Expr</span><span class="o">.</span><span class="i">Let</span> (<span class="i">bind</span>,<span class="i">body</span>,_,_)  <span class="k">-&gt;</span> 
        <span class="c">// This case implemented here to get a guaranteed tailcall </span>
        <span class="c">// Make sure we generate the sequence point outside the scope of the variable</span>
        <span class="k">let</span> <span class="i">startScope</span>,<span class="i">endScope</span> <span class="k">as</span> <span class="i">scopeMarks</span> <span class="o">=</span> <span class="i">StartDelayedLocalScope</span> <span class="s">&quot;let&quot;</span> <span class="i">cgbuf</span>
        <span class="k">let</span> <span class="i">eenv</span> <span class="o">=</span> <span class="i">AllocStorageForBind</span> <span class="i">cenv</span> <span class="i">cgbuf</span> <span class="i">scopeMarks</span> <span class="i">eenv</span> <span class="i">bind</span>
        <span class="k">let</span> <span class="i">spBind</span> <span class="o">=</span> <span class="i">GenSequencePointForBind</span> <span class="i">cenv</span> <span class="i">cgbuf</span> <span class="i">bind</span>
        <span class="i">CG</span><span class="o">.</span><span class="i">SetMarkToHere</span> <span class="i">cgbuf</span> <span class="i">startScope</span> 
        <span class="i">GenBindAfterSequencePoint</span> <span class="i">cenv</span> <span class="i">cgbuf</span> <span class="i">eenv</span> <span class="i">spBind</span> <span class="i">bind</span>
    | <span class="o">..</span><span class="o">.</span>
</code></pre></td>
</tr>
</table>
</section>
<section >
<h3>FSharp.Compiler.Service</h3>
<img src="images/FCS.png" alt="FSharp.Compiler.Service" >
</section>
<section >
<h3>Code gen: Fable</h3>
<img src="images/fable.png" alt="Fable" >
</section>
</section>
<section >
<p>Thank you</p>
</section>


        </div>
    </div>
    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>
    <script>
        // Add the nohighlight class and data-noescape attribute to code elements that have already been formatted by FSharp.Formatting
        $('pre.highlighted code').addClass('nohighlight').attr('data-noescape', '');

        // Full list of configuration options available here:
        // https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            controls: true,
            progress: true,
            history: true,
            center: true,

            transition: 'default', // default/cube/page/concave/zoom/linear/fade/none

            // Parallax scrolling
            // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
            // parallaxBackgroundSize: '2100px 900px',

            // Optional libraries used to extend on reveal.js
            dependencies: [
                { src: 'lib/js/classList.js', condition: function () { return !document.body.classList; } },
                { src: 'plugin/markdown/marked.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
                { src: 'plugin/markdown/markdown.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
                { src: 'plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } },
                { src: 'plugin/zoom-js/zoom.js', async: true, condition: function () { return !!document.body.classList; } },
                { src: 'plugin/notes/notes.js', async: true, condition: function () { return !!document.body.classList; } }
            ]
        });

    </script>
</body>
</html>

